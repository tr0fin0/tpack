%% tpack.sty
%% ---------------------------------------------
%% A package creeated for the classes repository
%%
%% by Guilherme Trofino.
%% ---------------------------------------------




% ----------------------------------------------
%               Presets
% ----------------------------------------------


\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{tpack}[2022/05/17 Trofino's Report Package]



% ----------------------------------------------
%               Packages: Required
% ----------------------------------------------


\usepackage[utf8]{inputenc}                                         % Language Presets
\usepackage[english, french, portuguese]{babel}                     % Text Correction
\usepackage{iflang}                                                 % Condition based on language

\usepackage{geometry, indentfirst, subcaption, subfiles, titlesec}  % General Presets
\usepackage{titling}                                                % General Presets
\usepackage{enumitem, multicol, multirow}                           % Text Enviroments

\usepackage{hyperref}                                               %
\usepackage{bookmark, chngcntr, comment, csquotes, filecontents}    % File Manapulation

\usepackage{amsmath, amssymb, amsthm, cancel, float, mathtools}     % Math Presets
\usepackage{array, systeme}                                         % Table Presets
\usepackage[thinc]{esdiff}                                          % Derivatives Presets
\usepackage{steinmetz}                                              % Fasorial Representation, https://tex.stackexchange.com/questions/185079/angle-notation-for-complex-numbers-in-polar-form

\usepackage{graphicx}                                               % Colors
\usepackage[table]{xcolor}                                          % Colors
\usepackage[many]{tcolorbox}                                        % Enviroment

\usepackage{circuitikz, tikz}                                       % Illustration
\usepackage{forest, karnaugh-map, pgfplots}
\usepackage{accsupp, listings}

\usetikzlibrary{positioning, fit, backgrounds}                      % Modules
\usetikzlibrary{matrix}                                             % Matrix
\usetikzlibrary{arrows, automata}                                   % Automata for State Machines (SM)

\usepgfplotslibrary{statistics}                                     % Necessary for Boxplot

\usepackage{siunitx}                                                % Units Package


% ----------------------------------------------
%               Packages: Customization
% ----------------------------------------------

                        % Page Setup
\geometry{
    a4paper,            % Page Size
    left=20mm,          % Left  Margin
    right=20mm,         % Right Margin
    bottom=25mm,        % Bottom Margin
    top=30mm,           % Top    Margin
    marginparwidth=50mm %
}

                                % Multicolumns Setup
\setlength{\multicolsep}{5mm}   % Enviroment Separation
\setlength{\columnsep}{7.5mm}   % Columns Separation

                        %
\restylefloat{table}

                                % Graphics Setup
\graphicspath{ {./images/} }    % Graphics Path

                                                % Colors Setup
\definecolor{darkgreen}{rgb}{0.0, 0.42, 0.24}   %
\definecolor{darkpurple}{rgb}{0.74, 0.2, 0.64}  %
\definecolor{darkblue}{rgb}{0.0, 0.28, 0.67}    %
\definecolor{mauve}{rgb}{0.58,0,0.82}           %

                                        % Numering Setup
\counterwithin{table}{section}          % Table {section}.{table}
\counterwithin{figure}{section}         % Figure {section}.{figure}
\counterwithin{equation}{section}       % Equation {section}..{equation}

% \renewcommand{\labelenumi}{(\alph{enumi})}
% \renewcommand{\labelenumii}{\roman{enumii}.}


\hypersetup{%
    colorlinks=true,
    linkcolor=blue!25!black, % Customize the link color (dark blue)
    urlcolor=blue!25!black, % Customize the URL color (dark blue)
    citecolor=blue!25!black, % Customize the citation color (dark blue)
    linkbordercolor=white, % Remove the outline box
    urlbordercolor=white, % Remove the outline box
    citebordercolor=white, % Remove the outline box
    pdftitle={\@title},
    pdfauthor={\@author}
}

\usepackage{fancyhdr}
\usepackage{lastpage} % Required for \pageref{LastPage}


\newcommand{\of}{\IfLanguageName{english}{of}{\IfLanguageName{french}{de}{\IfLanguageName{portuguese}{de}{none}}}}

\pagestyle{fancy}
\fancyhead{}
\fancyhead[L]{\@title}
\fancyhead[C]{}
\fancyhead[R]{\thepage\ \of\ \pageref{LastPage}}
\renewcommand{\headrulewidth}{0.085mm}

\fancyfoot{}
\fancyfoot[L]{\@project}
\fancyfoot[C]{}
\fancyfoot[R]{\@author}
\renewcommand{\footrulewidth}{0.085mm}



% ----------------------------------------------
%               BibTeX: Customization
% ----------------------------------------------


% https://latex.org/forum/viewtopic.php?t=10213
\renewenvironment{thebibliography}[1]{%
  \section*{\refname \@mkboth{\MakeUppercase\refname}{\MakeUppercase\refname}}%
  \begin{multicols}{2}
  \list{\@biblabel{\@arabic\c@enumiv}}{%
    \settowidth\labelwidth{\@biblabel{#1}}%
    \leftmargin\labelwidth
    \advance\leftmargin\labelsep
    \@openbib@code
    \usecounter{enumiv}%
    \let\p@enumiv\@empty
    \renewcommand\theenumiv{\@arabic\c@enumiv}}%
    \sloppy
    \clubpenalty4000
    \@clubpenalty \clubpenalty
    \widowpenalty4000%
    \sfcode`\.\@m}
{
  \def\@noitemerr{\@latex@warning{Empty `thebibliography' environment}}%
  \endlist\end{multicols}
}



% ----------------------------------------------
%               Title Setup: Customization
% ----------------------------------------------



\let\stdsection\section
\renewcommand\section{\newpage\stdsection}  % New Page before Section

\titleformat
    {\section}              % Part
    [block]                 % Part Shape
    {\normalfont\LARGE}     % Font Size
    {\thesection. }         % Label Numbering
    {0mm}                   % Part Separation
    {}                      % Code Before
    [{\titlerule[0.1mm]}]   % Code After

    \titlespacing*{\section}{0mm}{0mm}{15mm}

\titleformat
    {\subsection}           % Part
    [block]                 % Part Shape
    {\normalfont\Large}     % Font Size
    {\thesubsection. }      % Label Numbering
    {0mm}                   % Part Separation
    {}                      % Code Before
    []                      % Code After

    \titlespacing*{\subsection}{0mm}{5mm}{2.5mm}

\titleformat
    {\subsubsection}        % Part
    [block]                 % Part Shape
    {\normalfont\large}     % Font Size
    {\thesubsubsection. }   % Label Numbering
    {0mm}                   % Part Separation
    {}                      % Code Before
    []                      % Code After

    \titlespacing*{\subsubsection}{0mm}{2.5mm}{2.5mm}


% ----------------------------------------------
%               Make Title: Customization
% ----------------------------------------------



\newcommand*{\project}[1]{\gdef\@project{#1}}
\newcommand*{\institution}[1]{\gdef\@institution{#1}}
\newcommand*{\university}[1]{\gdef\@university{#1}}
\newcommand*{\logo}[1]{\gdef\@logo{#1}}
\newcommand*{\supervisor}[1]{\gdef\@supervisor{#1}}
\newcommand*{\major}[1]{\gdef\@major{#1}}
\newcommand*{\minor}[1]{\gdef\@minor{#1}}
\newcommand*{\local}[1]{\gdef\@local{#1}}
\newcommand*{\presentation}[1]{\gdef\@presentation{#1}}



\renewcommand{\maketitle}{
    \begin{titlepage}
        \begin{figure}[ht]
            \centering\includegraphics[height=40mm]{\@logo}
        \end{figure}

        \centering
        \vspace{0.5cm}
        \MakeUppercase{\@institution}\\
        \MakeUppercase{\@university}

        \vspace{0.5cm}
        \rule{\textwidth}{0.25pt}\\
        {\huge\bfseries\@title\unskip\strut\par}
        {\large\@project\unskip\strut\par}
        \rule{\textwidth}{0.25pt}\\

        \vspace{0.5cm}
        by\\
        {\Large\@author\unskip\strut\par}
        \begin{flushleft}
            supervised by\\
            {\large\@supervisor\unskip\strut\par}
        \end{flushleft}


        \vspace*{\fill}
        \color{red}
        \noindent\fbox{%
        \parbox{\textwidth}{%
           \centering{\large\textbf{Confidentiality Notice}}\\
           \centering{\normalsize Non-confidential and publishable report}
           }
        }
        \color{black}


        \vspace*{\fill}
        \@presentation

        \vspace{1cm}
        {\MakeUppercase{\@major}\\\MakeUppercase{\@minor}\unskip\strut\par}
        \rule{0.5\textwidth}{0.25pt}\\
        {\@local\\\today\unskip\strut\par}
    \end{titlepage}
}



% ----------------------------------------------
%               Table of Contents: Customization
% ----------------------------------------------

                                                    % Table of Contents
\addtocontents{toc}{\protect\thispagestyle{empty}}  % Remove Numbering



% ----------------------------------------------
%               Table: Customization
% ----------------------------------------------

\newcommand{\mycell}[2]{
    \begin{tabular}{@{}c@{}c@{}}&\tiny #2\\\normalfont #1&\end{tabular}}



% ----------------------------------------------
%               Listings: Customization
% ----------------------------------------------

% works with the following languages:
%   [x86masm]Assembler
%   Bash
%   C++
%   C
%   Python
%   VHDL

\newcommand{\mycode}{                               % Name after the Language used
    \lstset{
        basicstyle=\ttfamily\small,                 % Code Font Size
        keywordstyle=\color{darkpurple}\bfseries,   % Color Key Word
        stringstyle=\color{darkblue},               % Color String
        identifierstyle=\color{teal},
        commentstyle=\color{darkgreen},             % Color Comment
        morecomment=[s][\color{blue}]{/**}{*/},     % Color Comment
        tabsize=2,                                  % Tab Size
        captionpos=b,                               % Caption Position
        showtabs=false,                             % Show Tabs within Strings
        showspaces=false,                           % Show Spaces Code
        showstringspaces=false,                     % Show Spaces Strings
        stepnumber=1,                               % Line Number Step
        numbers=left,                               % Line Number Position
        numbersep=5pt,                              % Line Number Distance from Code
        numberstyle=\tiny\color{gray},              % Line Number Style
        frame=single,                               % Frame
        rulecolor=\color{black},                    % Frame Color
        xleftmargin=10pt,                           % Left Margin
        backgroundcolor=\color{white},              % Background Color
        breaklines=true,                            % Break Automatic Line
        breakatwhitespace=true,                     % Break Automatic Spaces
        breakautoindent=false,                      % Break Automatic Indent
        extendedchars=true,                         %
        inputencoding=latin1,                       % Encoding
        literate=                                   % Including Especial Charects
                {é}{{\'{e}}}1
                {è}{{\`{e}}}1
                {ê}{{\^{e}}}1
                {ë}{{\¨{e}}}1
                {É}{{\'{E}}}1
                {Ê}{{\^{E}}}1
                {û}{{\^{u}}}1
                {ù}{{\`{u}}}1
                {ú}{{\'{u}}}1
                {â}{{\^{a}}}1
                {à}{{\`{a}}}1
                {á}{{\'{a}}}1
                {ã}{{\~{a}}}1
                {ä}{{\"{a}}}1
                {Á}{{\'{A}}}1
                {Â}{{\^{A}}}1
                {Ã}{{\~{A}}}1
                {Ä}{{\"{A}}}1
                {ç}{{\c{c}}}1
                {Ç}{{\c{C}}}1
                {õ}{{\~{o}}}1
                {ó}{{\'{o}}}1
                {ô}{{\^{o}}}1
                {ö}{{\"{o}}}1
                {Õ}{{\~{O}}}1
                {Ó}{{\'{O}}}1
                {Ô}{{\^{O}}}1
                {Ö}{{\"{O}}}1
                {î}{{\^{i}}}1
                {Î}{{\^{I}}}1
                {í}{{\'{i}}}1
                {Í}{{\~{Í}}}1
                {ü}{{\"{u}}}1
                {Ü}{{\"{U}}}1
    }
}




\lstdefinelanguage[RISC-V]{Assembler}{ %https://gist.github.com/AntonLydike/e339c3c3a4dcab8bc3c620b3fa436cda
    alsoletter={.},       % allow dots in keywords
    alsodigit={0x},       % hex numbers are numbers too!
    morekeywords=[1]{     % instructions
        lb, lh, lw, lbu, lhu,
        sb, sh, sw,
        sll, slli, srl, srli, sra, srai,
        add, addi, sub, subi, lui, auipc,
        xor, xori, or, ori, and, andi,
        slt, slti, sltu, sltiu,
        beq, bne,  blt, bge, bltu, bgeu,
        j, jr, jal, jalr, ret,
        scall, break, nop, not
    },
    morekeywords=[2]{     % sections of our code and other directives
        .align, .ascii, .asciiz, .byte, .data, .double, .extern,
        .float, .globl, .half, .kdata, .ktext, .set, .space, .text, .word
    },
    morekeywords=[3]{     % registers
        zero, ra, sp, gp, tp, s0, fp,
        t0, t1, t2, t3, t4, t5, t6,
        s1, s2, s3, s4, s5, s6, s7, s8, s9, s10, s11,
        a0, a1, a2, a3, a4, a5, a6, a7,
        ft0, ft1, ft2, ft3, ft4, ft5, ft6, ft7,
        fs0, fs1, fs2, fs3, fs4, fs5, fs6, fs7, fs8, fs9, fs10, fs11,
        fa0, fa1, fa2, fa3, fa4, fa5, fa6, fa7
    },
    morecomment=[l]{;},   % mark ; as line comment start
    morecomment=[l]{\#},  % as well as # (even though it is unconventional)
    morestring=[b]",      % mark " as string start/end
    morestring=[b]'       % also mark ' as string start/end
}

\newcommand{\myRISCV}{
    \lstset{
        language=[RISC-V]Assembler,
        basicstyle=\ttfamily\small,
        keywordstyle=[1]\color{blue!80!black},
        keywordstyle=[2]\color{orange!80!black},
        keywordstyle=[3]\color{red!50!black},
        stringstyle=\color{mauve},
        identifierstyle=\color{teal},
        commentstyle=\color{darkgreen},
        morecomment=[s][\color{blue}]{/**}{*/},
        captionpos=b,
        % xleftmargin=0pt,
        xleftmargin=\dimexpr\fboxsep+\fboxrule\relax,
        xrightmargin=\dimexpr\fboxsep+\fboxrule\relax,
        tabsize=4,
        showtabs=false,
        showspaces=false,
        showstringspaces=false,
        breaklines=true,
        breakatwhitespace=true,
        breakautoindent=false,
        numbers=left,
        numbersep=5pt,
        numberstyle=\tiny\color{gray},
        stepnumber=1,
        columns=flexible,
        frame=l,
        rulecolor=\color{black},
        backgroundcolor=\color{white},
        extendedchars=true,
        inputencoding=latin1,
        literate=
                {é}{{\'{e}}}1
                {è}{{\`{e}}}1
                {ê}{{\^{e}}}1
                {ë}{{\¨{e}}}1
                {É}{{\'{E}}}1
                {Ê}{{\^{E}}}1
                {û}{{\^{u}}}1
                {ù}{{\`{u}}}1
                {ú}{{\'{u}}}1
                {â}{{\^{a}}}1
                {à}{{\`{a}}}1
                {á}{{\'{a}}}1
                {ã}{{\~{a}}}1
                {ä}{{\"{a}}}1
                {Á}{{\'{A}}}1
                {Â}{{\^{A}}}1
                {Ã}{{\~{A}}}1
                {Ä}{{\"{A}}}1
                {ç}{{\c{c}}}1
                {Ç}{{\c{C}}}1
                {õ}{{\~{o}}}1
                {ó}{{\'{o}}}1
                {ô}{{\^{o}}}1
                {ö}{{\"{o}}}1
                {Õ}{{\~{O}}}1
                {Ó}{{\'{O}}}1
                {Ô}{{\^{O}}}1
                {Ö}{{\"{O}}}1
                {î}{{\^{i}}}1
                {Î}{{\^{I}}}1
                {í}{{\'{i}}}1
                {Í}{{\~{Í}}}1
                {ü}{{\"{u}}}1
                {Ü}{{\"{U}}}1
    }
}


\lstdefinelanguage{Pseudocode}{
    morekeywords=[1]{     % instructions
        if, else, switch, case
        },
    morekeywords=[2]{     % sections of our code and other directives
        for, while,
        },
    morekeywords=[3]{     % registers
        input, output, begin, end, return,
    },
}

\newcommand{\mypseudocode}{
    \lstset{
        language=Pseudocode,
        basicstyle=\ttfamily\small,
        keywordstyle=[1]\color{gray}\bfseries,
        keywordstyle=[2]\color{gray}\bfseries,
        keywordstyle=[3]\color{gray}\bfseries,
        stringstyle=\color{black},
        identifierstyle=\color{black},
        commentstyle=\color{black},
        morecomment=[s][\color{black}]{/**}{*/},
        captionpos=b,
        % xleftmargin=0pt,
        xleftmargin=\dimexpr\fboxsep+\fboxrule\relax,
        xrightmargin=\dimexpr\fboxsep+\fboxrule\relax,
        tabsize=4,
        showtabs=false,
        showspaces=false,
        showstringspaces=false,
        breaklines=true,
        breakatwhitespace=true,
        breakautoindent=false,
        numbers=left,
        numbersep=5pt,
        numberstyle=\tiny\color{gray},
        stepnumber=1,
        columns=flexible,
        frame=l,
        rulecolor=\color{black},
        backgroundcolor=\color{white},
        extendedchars=true,
        inputencoding=latin1,
        literate=
                {é}{{\'{e}}}1
                {è}{{\`{e}}}1
                {ê}{{\^{e}}}1
                {ë}{{\¨{e}}}1
                {É}{{\'{E}}}1
                {Ê}{{\^{E}}}1
                {û}{{\^{u}}}1
                {ù}{{\`{u}}}1
                {ú}{{\'{u}}}1
                {â}{{\^{a}}}1
                {à}{{\`{a}}}1
                {á}{{\'{a}}}1
                {ã}{{\~{a}}}1
                {ä}{{\"{a}}}1
                {Á}{{\'{A}}}1
                {Â}{{\^{A}}}1
                {Ã}{{\~{A}}}1
                {Ä}{{\"{A}}}1
                {ç}{{\c{c}}}1
                {Ç}{{\c{C}}}1
                {õ}{{\~{o}}}1
                {ó}{{\'{o}}}1
                {ô}{{\^{o}}}1
                {ö}{{\"{o}}}1
                {Õ}{{\~{O}}}1
                {Ó}{{\'{O}}}1
                {Ô}{{\^{O}}}1
                {Ö}{{\"{O}}}1
                {î}{{\^{i}}}1
                {Î}{{\^{I}}}1
                {í}{{\'{i}}}1
                {Í}{{\~{Í}}}1
                {ü}{{\"{u}}}1
                {Ü}{{\"{U}}}1
    }
}



% ----------------------------------------------
%               Circuitikz: Customization
% ----------------------------------------------

\tikzset{
    mux2by1/.style={
        muxdemux, muxdemux def={
            Lh=4,
            Rh=2,
            w=2,
            NL=2,
            NB=1,
            NR=1,
            NT=0,
            inset Lh=0,
            inset Rh=0,
            inset w=0,
            square pins=0
        }
    }
}

\tikzset{
    demux2by1/.style={
        muxdemux, muxdemux def={
            Lh=2,
            Rh=4,
            w=2,
            NL=1,
            NB=1,
            NR=2,
            NT=0,
            inset Lh=0,
            inset Rh=0,
            inset w=0,
            square pins=0
        }
    }
}

\ctikzset{
    component text=left,
    diodes/scale=0.5,
    capacitors/scale=0.75,
    resistors/width=0.25,
    resistors/zigs=1
}



% ----------------------------------------------
%               Environment: Customization
% ----------------------------------------------

\newtheoremstyle{mystyle}   % Name
  {}                        % Space Above
  {}                        % Space Below
  {}                        % Body Font
  {}                        % Indent Amount
  {\bfseries}               % Theorem Head Font
  {.}                       % Punctuation after Theorem
  { }                       % Space after Theorem
  {}                        % Theorem Head Specification


% Numbering Enviroments AMSTHM
% \newtheorem{〈env name〉}{〈text 〉}[〈parent counter 〉]
% \newtheorem{〈env name〉}[〈shared counter 〉]{〈text 〉}


\newcommand{\tdefinition}{\IfLanguageName{english}{Definition}{\IfLanguageName{french}{Définition}{\IfLanguageName{portuguese}{Definição}{none}}}}
\newcommand{\ttheorem}{\IfLanguageName{english}{Theorem}{\IfLanguageName{french}{Théorème}{\IfLanguageName{portuguese}{Teorema}{none}}}}
\newcommand{\tlemma}{\IfLanguageName{english}{Lemma}{\IfLanguageName{french}{Lemme}{\IfLanguageName{portuguese}{Lema}{none}}}}
\newcommand{\tproof}{\IfLanguageName{english}{Proof}{\IfLanguageName{french}{Preuve}{\IfLanguageName{portuguese}{Prova}{none}}}}
\newcommand{\tremark}{\IfLanguageName{english}{Remark}{\IfLanguageName{french}{Remarque}{\IfLanguageName{portuguese}{Remarca}{none}}}}
\newcommand{\tphrase}{\IfLanguageName{english}{Phrase}{\IfLanguageName{french}{Phrase}{\IfLanguageName{portuguese}{Frase}{none}}}}
\newcommand{\texample}{\IfLanguageName{english}{Example}{\IfLanguageName{french}{Exemple}{\IfLanguageName{portuguese}{Exemplo}{none}}}}
\newcommand{\texercise}{\IfLanguageName{english}{Exercise}{\IfLanguageName{french}{Exercice}{\IfLanguageName{portuguese}{Exercício}{none}}}}
\newcommand{\tresolution}{\IfLanguageName{english}{Resolution}{\IfLanguageName{french}{Résolution}{\IfLanguageName{portuguese}{Resolução}{none}}}}

\theoremstyle{mystyle}{
    \newtheorem{definition}{\tdefinition}[section]
}

\theoremstyle{mystyle}{
    \newtheorem{theorem}{\ttheorem}[section]
}

\theoremstyle{mystyle}{
    \newtheorem{lemma}[theorem]{\tlemma}
}

\renewenvironment{proof}{{\bfseries \tproof }}{\qed}  % Add QED symbol

\theoremstyle{mystyle}{
    \newtheorem*{remark}{\tremark}
}

\theoremstyle{mystyle}{
    \newtheorem*{phrase}{\tphrase}
}

\theoremstyle{mystyle}{
    \newtheorem{example}{\texample}[section]
}

\theoremstyle{mystyle}{
    \newtheorem{exercise}{\texercise}[section]
}

\theoremstyle{mystyle}{
    \newtheorem*{resolution}{\tresolution}
}


\tcolorboxenvironment{definition}{
    boxrule=0.1mm,                          % Box Thickness outline
    boxsep=2pt,
    enhanced jigsaw,
    colback={white},
    borderline west={1mm}{0pt}{black},      % Thickness
    sharp corners,                          % Corners Style
    before skip=10pt,
    after skip=10pt,
    breakable,
}

\tcolorboxenvironment{theorem}{
    boxrule=0.1mm,
    boxsep=2pt,
    enhanced jigsaw,
    colback={white},
    borderline west={1mm}{0pt}{magenta},
    sharp corners,
    before skip=10pt,
    after skip=10pt,
    breakable,
}

\tcolorboxenvironment{lemma}{
    boxrule=0.1mm,
    boxsep=2pt,
    enhanced jigsaw,
    colback={white},
    borderline west={1mm}{0pt}{olive},
    sharp corners,
    before skip=10pt,
    after skip=10pt,
    left=12pt,
    right=12pt,
    breakable,
}

\tcolorboxenvironment{proof}{
    boxrule=0.1mm,
    boxsep=2pt,
    enhanced jigsaw,
    colback={white},
    borderline west={1mm}{0pt}{orange},
    sharp corners,
    before skip=10pt,
    after skip=10pt,
    left=12pt,
    right=12pt,
    breakable,
}

\tcolorboxenvironment{remark}{
    boxrule=0.1mm,
    boxsep=2pt,
    enhanced jigsaw,
    colback={white},
    borderline west={1mm}{0pt}{brown},
    sharp corners,
    before skip=10pt,
    after skip=10pt,
    left=12pt,
    right=12pt,
    breakable,
}

\tcolorboxenvironment{phrase}{
    boxrule=0.1mm,
    boxsep=2pt,
    enhanced jigsaw,
    colback={white},
    borderline west={1mm}{0pt}{red},
    borderline east={1mm}{0pt}{red},
    sharp corners,
    before skip=10pt,
    after skip=10pt,
    left=12pt,
    right=12pt,
    breakable,
}

\tcolorboxenvironment{example}{
    boxrule=0.1mm,
    boxsep=2pt,
    enhanced jigsaw,
    colback={white},
    borderline west={1mm}{0pt}{violet},
    sharp corners,
    before skip=10pt,
    after skip=10pt,
    left=12pt,
    right=12pt,
    breakable,
}

\tcolorboxenvironment{exercise}{
    boxrule=0.1mm,
    boxsep=2pt,
    enhanced jigsaw,
    colback={white},
    borderline west={1mm}{0pt}{teal},
    sharp corners,
    before skip=10pt,
    after skip=10pt,
    left=12pt,
    right=12pt,
    breakable,
}

\tcolorboxenvironment{resolution}{
    boxrule=0.1mm,
    boxsep=2pt,
    enhanced jigsaw,
    colback={white},
    borderline west={1mm}{0pt}{darkgray},
    sharp corners,
    before skip=10pt,
    after skip=10pt,
    left=12pt,
    right=12pt,
    breakable,
}



% ----------------------------------------------
%               Forest: Customization
% ----------------------------------------------

\tikzset{
    iv/.style={
        draw,
        fill=white,
        circle,
        minimum size=20pt,
        inner sep=0pt,
        text=black
    },
    ev/.style={
        draw,
        fill=gray!50,
        rectangle,
        minimum size=20pt,
        inner sep=0pt,
        text=black
    }
}


% ----------------------------------------------
%               Module: Customization
% ----------------------------------------------

\tikzset{
    module/.style={%
        draw, rounded corners,
        minimum width=#1,
        minimum height=7mm,
        font=\sffamily
        },
    module/.default=2cm,
    >=LaTeX
}


% ----------------------------------------------
%               Tikz: Customization
% ----------------------------------------------
\pgfplotsset{compat=newest}
\usetikzlibrary{patterns}



% Function to Represent Sucession Division
% Decimal to Binary Conversion
\newcount\total
\newcount\lasttotal
\newcount\targetbase

\def\basetenconversiontable#1#2{%
    \begin{tikzpicture}[every node/.style={minimum width=1cm, minimum height=0.5cm}, x=1cm,y=0.5cm]
    %
    \total=#1%
    \targetbase=#2
    \def\newnumber{}
    %
    \pgfmathloop
    \ifnum\total<1
    \else
        %
        \ifnum\pgfmathcounter>1
            \node at (\pgfmathcounter, -\pgfmathcounter+1) (tmp) {\the\targetbase};
            \draw (tmp.north west) |- (tmp.south east);
            %
            \node at (\pgfmathcounter-1, -\pgfmathcounter) (tmp) {\pgfmathparse{int(\total*\targetbase)}\pgfmathresult};
            \draw (tmp.south west) -- (tmp.south east);
            %
            \pgfmathparse{int(\lasttotal-\total*\targetbase)}%
            \let\digit=\pgfmathresult
            \node at (\pgfmathcounter-1, -\pgfmathcounter-1) [text=red] {\digit};
            \edef\newnumber{\digit\newnumber}
        \fi
        %
        \ifnum\total<\targetbase
                \edef\newnumber{\the\total\newnumber}
            \node at (\pgfmathcounter, -\pgfmathcounter) [text=red]  {\the\total};
        \else
            \node at (\pgfmathcounter, -\pgfmathcounter) {\the\total};
        \fi
        \lasttotal=\total
        \divide\total by\targetbase
    \repeatpgfmathloop
    \draw [->] (\pgfmathcounter-1,-\pgfmathcounter-1) -- ++(-0.5,0);
    \node [anchor=west] at (1, -\pgfmathcounter-2) {$\boxed{#1_{(10)}=\newnumber_{(\the\targetbase)}}$};
    \end{tikzpicture}
}


%%% macros to display the computation of a decimal representation of a positive
%%% integer given in base b representation with b at most 36

\makeatletter

\newcount\@nn
\newcount\@mm
\newcount\@base

% globally sets the counter \@mm to the decimal number represented by #1
% which is either a digit 0-9 or a letter A-Z or a-z
% no check on input done!
%\def\@set@mmto #1{\@mm`#1 \advance\@mm-48
%      \ifnum\@mm>48 \advance\@mm-39 \else
%      \ifnum\@mm>16 \advance\@mm-7 \fi\fi \global\@mm\@mm}
% I had initially:
\def\@set@mmto #1{\@mm`#1
  \ifnum\@mm>96 \advance\@mm-87 \else
  \ifnum\@mm>64 \advance\@mm-55 \else
  \advance\@mm-48 \fi\fi \global\@mm\@mm}

% prepares the first three entries of a row of the future tabular
% \@nn represents the decimal number so far computed, and will
% turn into base times itself plus new digit
% global assignments to transcend cells
\def\@mostofonerow#1{\xdef\@digitssofar{\@digitssofar#1}%
    \@set@mmto #1%
    $\mathtt{\@digitssofar_{\the@base}}\rightarrow\the\@mm\;$%
    &%
    ${}+\the@base\times\the\@nn$%
    \multiply\@nn\@base
    \advance\@nn\@mm
    \global\@nn\@nn
    &${}={}$&}

% this is for displaying the final result in a box
\def\@endfinalrow{\fbox{$\the\@nn_{10}$}\\}

% this is the non-boxed intermediate result ending a row
\def\@endnormalrow{$\the\@nn$\\}

% recursive construction of successive rows
\def\@makenextrows#1{\ifx#1.\@endfinalrow\else
          \@endnormalrow\@mostofonerow#1\expandafter\@makenextrows\fi}

% first step for initialization. Checks for empty argument.
\def\@makerows #1{\ifx#1.\else\@mostofonerow#1\expandafter\@makenextrows\fi}

%% actually constructs the tabular with the computation
%% [moved to \todecimal]
%\def\@displayrows #1{{\setlength{\tabcolsep}{0pt}%
%               \begin{tabular}[t]{r|lcl}#1\end{tabular}}}

\newcommand{\todecimal}[2][2]{%
\@base=#1\def\the@base{#1}%
\@nn=0
\def\@digitssofar{}%
\oalign{$\mathtt{#2_{#1}}:$\hfil\cr
%%%% replaced
%%%% \expandafter\@displayrows\expandafter{\@makerows #2.}}}
%%%% with the simpler:
        {%
         \setlength{\tabcolsep}{0pt}%
         \begin{tabular}[t]{r|lcl}
         \@makerows #2.
         \end{tabular}%
        }%
       }%
} % end ot \todecimal





% Function to Represent Binary Multiplication
% Shift and Sum Methody
\makeatletter
\providecommand\text\mbox
\newenvironment{arithmetic}[1][]{\begin{tabular}[#1]{Al}}{\end{tabular}}
\newcolumntype{A}{>{\bgroup\def~{\phantom{0}}$\@testOptor}r<{\@gobble\\$\egroup}}

\def\@testOptor\ignorespaces#1#2\\{%
    \ifx#1\times
        \@OperatorRow{#1}{#2}\@tempa%
    \else\ifx#1+
        \@OperatorRow+{#2}\@tempa%
    \else\ifx#1\discretionary% detects the soft hyphen, \-
        \@ShortSubtractRow{#2}\@tempa%
    \else\ifx#1-
        \@OperatorRow-{#2}\@tempa%
    \else
        \@NormalRow{#1#2}\@tempa%
    \fi\fi\fi\fi
    \@tempa}


    \def\@OperatorRow#1#2#3{%
    \@IfEndRow#2\@gobble\\{%
        \def#3{\underline{{}#1 #2}\\}%
    }{%
        \def#3{\underline{{}#1 #2{}}}%
    }}

\def\@NormalRow#1#2{%
    \@IfEndRow#1\@gobble\\{%
        \def#2{#1\\}%
    }{%
        \def#2{#1{}}%
    }}

\def\@IfEndRow#1\@gobble#2\\#3#4{%
    \ifx#2\@gobble
        #4%
    \else
        #3%
    \fi}

\makeatother

\def\@ShortSubtractRow#1#2{\@@ShortSubtractRow#1~\end{#2}}
\def\@@ShortSubtractRow#1#2~#3\end#4{%
    \@IfEndRow#3\@gobble\\{%
        \def#4{\underline{\text{--} #2}#3\\}%
    }{%
        \def#4{\underline{\text{--} #2{}}#3}%
    }}

    \def\Into#1\\{%
    \@IfEndRow#1\@gobble\\{%
        \def\@tempa{~\raisebox{0.17ex}{\parbox{0.15em}{\centering$\big|$}}\overline{~\big.#1}\\}%
    }{%
        \def\@tempa{~\raisebox{0.17ex}{\parbox{0.15em}{\centering$\big|$}}\overline{~\big.#1{}}}%
    }\@tempa}

\makeatother



\tikzset{
    tolstyle/.style={
        draw,
        on chain=going right,
        inner ysep=0pt,
        minimum height=1.7em
    },
    type/.style={tol#1},
    modifier/.style={tolmodifier,font=#1}
}

\newcommand{\tol}[1]{%
    \begin{tikzpicture}[baseline=-0.3em,
        start chain,
        node distance=-\pgflinewidth
    ]
        \foreach \content in {#1} {
            \IfSubStr{\content}{type}{
                \edef\donode{%
                    \noexpand\node[
                        tolstyle,
                        minimum width=\noexpand\pgfkeysvalueof{/pgf/minimum height},
                        \content
                    ]{};
                }
                \donode
            }{
                \IfSubStr{\content}{modifier}{
                \edef\donode{\noexpand\node[tolstyle,tolmodifier,minimum width=\noexpand\pgfkeysvalueof{/pgf/minimum height},\content]{};}
                \donode
            }
                \node[tolstyle]{\content};
            }
        }
    \end{tikzpicture}%
}

\endinput
